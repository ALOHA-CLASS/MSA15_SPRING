<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œê¸€ ìˆ˜ì •</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.min.css" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-fileinput@5.5.3/css/fileinput.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <!-- <div class="col-12 col-md-10 col-lg-6"> -->
      <div class="col-12">
        <h1 class="text-center">ê²Œì‹œê¸€ ìˆ˜ì •</h1>
        <form id="form" action="/board/update" method="post" enctype="multipart/form-data" th:object="${board}">
            <div class="mb-3">
              <label for="title" class="form-label">ì œëª©</label>
              <input type="text" class="form-control" th:field="*{title}" aria-describedby="helpTitle" placeholder=""/>
              <small id="helpTitle" class="form-text text-muted">ì œëª© ì…ë ¥</small>
            </div>
            <div class="mb-3">
              <label for="writer" class="form-label">ì‘ì„±ì</label>
              <input type="text" class="form-control" th:field="*{writer}" aria-describedby="helpWriter" placeholder=""/>
              <small id="helpWriter" class="form-text text-muted">ì‘ì„±ì ì…ë ¥</small>
            </div>
            <div class="mb-3">
              <label for="content" class="form-label">ë‚´ìš©</label>
              <textarea class="form-control" th:field="*{content}" rows="3" aria-describedby="helpContent"></textarea>
              <small id="helpContent" class="form-text text-muted">ë‚´ìš© ì…ë ¥</small>
            </div>
            <div class="mb-3">
              <label class="form-label">íŒŒì¼ëª©ë¡</label>
              <input id="file1" type="file" class="file" multiple>
            </div>
            <div class="mb-3">
              <label class="form-label">ì²¨ë¶€íŒŒì¼</label>
              <input id="file2" type="file" name="files" class="file" multiple>
            </div>
            <input type="hidden" th:field="*{no}">
            <div class="d-grid gap-2 d-md-flex justify-content-md-center mt-2">
              <button type="submit" class="btn btn-primary w-100">ìˆ˜ì •</button>
            </div>
            <div class="d-grid gap-2 d-md-flex justify-content-md-center mt-2">
              <button type="button" class="btn btn-outline-secondary w-100" onclick="moveList()">ëª©ë¡</button>
              <button type="button" class="btn btn-outline-danger w-100" onclick="actionDelete()">ì‚­ì œ</button>
            </div>
          </form>
      </div>
    </div>
  </div>  


  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap-fileinput@5.5.3/js/fileinput.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-fileinput@5.5.3/themes/fas/theme.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.5.0/js/plugins/sortable.min.js" type="text/javascript"></script>
  <script src="/js/locales/kr.js"></script>

  <script>
      let form = document.getElementById('form')

      // ğŸ‘©â€ğŸ’» ëª¨ë¸ ê°ì²´ë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•
      let no = "[[${board.no}]]"
      
      // ì‚­ì œ ìš”ì²­
      function actionDelete() {
          let check = confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')
          if( check ) {
              form.action = '/board/delete'
              form.submit()
          }
      }

      // ëª©ë¡ í™”ë©´ ì´ë™
      function moveList() {
          location.href = '/board/list'
      }
  </script>

  <script th:inline="javascript">

      let fileList = [[${board.fileList}]]

      let initialPreview = [];
      let initialPreviewConfig = [];

      fileList.forEach(function(file) {
          // íŒŒì¼ì˜ URL ìƒì„±
          let fileUrl = '/files/' + file.id;

          // initialPreview ë°°ì—´ì— íŒŒì¼ URL ì¶”ê°€
          initialPreview.push(fileUrl);

          // initialPreviewConfig ë°°ì—´ì— íŒŒì¼ ì„¤ì • ì¶”ê°€
          initialPreviewConfig.push({
              caption: file.name,
              size: file.size,
              width: "120px",
              url: '/files/' + file.id, // ì‚­ì œ ìš”ì²­ URL
              key: file.id
          });
      });

      console.log(initialPreview);
      console.log(initialPreviewConfig);

      $("#file1").fileinput({
          language: "kr",                               // ì–¸ì–´ ì„¤ì •          
          initialPreview: initialPreview,               // ë¯¸ë¦¬ë³´ê¸°í•  íŒŒì¼ì˜ URL ë°°ì—´
          initialPreviewAsData: true,                   // â˜… URLì„ ì´ë¯¸ì§€/íŒŒì¼ë¡œ ì¸ì‹
          initialPreviewConfig: initialPreviewConfig,   // ë¯¸ë¦¬ë³´ê¸° ì„¤ì •
          // initialPreviewShowDelete: false,              // íŒŒì¼ë³„ ì‚­ì œë²„íŠ¼ ìˆ¨ê¹€
          showUpload: false,                            // ì—…ë¡œë“œ ë²„íŠ¼ ìˆ¨ê¹€
          showRemove: false,                            // ì „ì²´ ì‚­ì œë²„íŠ¼ ìˆ¨ê¹€
          showBrowse: false,                            // íŒŒì¼ ì°¾ì•„ë³´ê¸° ë²„íŠ¼ ìˆ¨ê¹€
          showCaption: false,                           // íŒŒì¼ ìº¡ì…˜ ìˆ¨ê¹€
          showClose: false,                              // ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸° ë²„íŠ¼ ìˆ¨ê¹€
          ajaxDeleteSettings: {
            type: "DELETE"  
          }
      }).on('filesorted', function(event, params) {
        // params.stack: ì •ë ¬ëœ íŒŒì¼ ë°°ì—´
        // params.newIndex: ì´ë™ í›„ ì¸ë±ìŠ¤
        // params.oldIndex: ì´ë™ ì „ ì¸ë±ìŠ¤
        console.log('File sorted:', params);
        console.log('New index:', params.newIndex);
        console.log('Old index:', params.oldIndex);
        console.log('Sorted stack:', params.stack);
        
        $.ajax({
          url: '/files/sort',
          type: 'PUT',
          contentType: 'application/json',
          data: JSON.stringify(params.stack),
          success: function(response) {
            console.log('Sort order updated successfully');
          },
          error: function(xhr, status, error) {
            console.error('Error updating sort order:', error);
          }
        });
      });

      


      $("#file2").fileinput({
          language: "kr",                               // ì–¸ì–´ ì„¤ì •          
          showUpload: false,                            // ì—…ë¡œë“œ ë²„íŠ¼ ìˆ¨ê¹€
          showRemove: false,                            // ì „ì²´ ì‚­ì œë²„íŠ¼ ìˆ¨ê¹€
          showClose: false,                              // ë¯¸ë¦¬ë³´ê¸° ë‹«ê¸° ë²„íŠ¼ ìˆ¨ê¹€
      });

  </script>
</body>
</html>